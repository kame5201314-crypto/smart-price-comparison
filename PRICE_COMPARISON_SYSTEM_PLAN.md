# æ™ºèƒ½å•†å“æ¯”åƒ¹ç³»çµ± - å®Œæ•´è¦åŠƒæ–‡æª”

## ğŸ“‹ ç³»çµ±æ¦‚è¿°

ä¸€å€‹æ™ºèƒ½åŒ–çš„å•†å“æ¯”åƒ¹å¹³å°ï¼Œæ”¯æŒé€šé**ç¶²å€**ã€**åœ–ç‰‡**æˆ–**ç”¢å“åç¨±**é€²è¡Œå¤šç¶²ç«™æ¯”åƒ¹ï¼Œä¸¦æä¾›å» å•†ç®¡ç†èˆ‡è¨‚è³¼è¿½è¹¤åŠŸèƒ½ã€‚

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½éœ€æ±‚

### 1. å¤šæ–¹å¼å•†å“æœå°‹
- **URLè¼¸å…¥**: è²¼ä¸Šå•†å“é€£çµè‡ªå‹•æŠ“å–å•†å“è³‡è¨Š
- **åœ–ç‰‡æœå°‹**: ä¸Šå‚³å•†å“åœ–ç‰‡é€²è¡Œè¦–è¦ºè­˜åˆ¥æœå°‹
- **åç¨±æœå°‹**: è¼¸å…¥é—œéµå­—æœå°‹å¤šå€‹é›»å•†å¹³å°

### 2. æ™ºèƒ½æ¯”åƒ¹å¼•æ“
- è‡ªå‹•çˆ¬å–å¤šå€‹é›»å•†å¹³å°åƒ¹æ ¼
- æ”¯æŒåƒ¹æ ¼ã€éŠ·å”®é‡æ’åº
- æ‰¹é‡å•†å“åŒæ™‚æ¯”åƒ¹ï¼ˆæœ€å¤š100å€‹å•†å“ï¼‰
- å³æ™‚åƒ¹æ ¼ç›£æ§èˆ‡æ­·å²åƒ¹æ ¼è¿½è¹¤

### 3. å» å•†ç®¡ç†ç³»çµ±
- è¨˜éŒ„æ¯”åƒ¹çµæœä¸­çš„å„ªè³ªå» å•†
- å» å•†è¯çµ¡è³‡è¨Šç®¡ç†
- è¨‚è³¼æ­·å²è¨˜éŒ„
- å» å•†è©•åˆ†èˆ‡å‚™è¨»

### 4. è¨‚è³¼è¿½è¹¤ç³»çµ±
- è¨‚å–®å»ºç«‹èˆ‡ç®¡ç†
- ç‰©æµç‹€æ…‹è¿½è¹¤
- æˆæœ¬åˆ†æèˆ‡å ±è¡¨

---

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å‰ç«¯å±¤ (React + TypeScript)           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ æœå°‹ä»‹é¢ â”‚  â”‚ æ¯”åƒ¹çµæœ â”‚  â”‚ å» å•†ç®¡ç† â”‚  â”‚ è¨‚å–®è¿½è¹¤ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  APIå±¤ (Node.js/Express)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ æœå°‹API  â”‚  â”‚ çˆ¬èŸ²API  â”‚  â”‚ å» å•†API  â”‚  â”‚ è¨‚å–®API  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æœå‹™å±¤                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ çˆ¬èŸ²å¼•æ“ â”‚  â”‚ åœ–ç‰‡è­˜åˆ¥ â”‚  â”‚ åƒ¹æ ¼åˆ†æ â”‚  â”‚ é€šçŸ¥æœå‹™ â”‚ â”‚
â”‚  â”‚ (Puppeteerâ”‚ â”‚ (AIè¦–è¦º) â”‚  â”‚          â”‚  â”‚          â”‚ â”‚
â”‚  â”‚ /Playwrightâ”‚ â”‚          â”‚  â”‚          â”‚  â”‚          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ•¸æ“šå±¤ (PostgreSQL + Redis)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ å•†å“è³‡æ–™ â”‚  â”‚ åƒ¹æ ¼æ­·å² â”‚  â”‚ å» å•†è³‡æ–™ â”‚  â”‚ è¨‚å–®è³‡æ–™ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                    Redis Cache (å¿«å–)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ æ•¸æ“šåº«è¨­è¨ˆ

### Products (å•†å“è¡¨)
```sql
CREATE TABLE products (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name VARCHAR(500) NOT NULL,
  description TEXT,
  category VARCHAR(100),
  image_url TEXT,
  original_url TEXT,
  specs JSONB, -- å•†å“è¦æ ¼
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  user_id UUID REFERENCES users(id)
);

CREATE INDEX idx_products_name ON products(name);
CREATE INDEX idx_products_user ON products(user_id);
```

### Price_Records (åƒ¹æ ¼è¨˜éŒ„è¡¨)
```sql
CREATE TABLE price_records (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  product_id UUID REFERENCES products(id),
  vendor_id UUID REFERENCES vendors(id),
  price DECIMAL(10, 2) NOT NULL,
  original_price DECIMAL(10, 2), -- åŸåƒ¹
  discount_rate DECIMAL(5, 2), -- æŠ˜æ‰£ç‡
  stock_status VARCHAR(50), -- åº«å­˜ç‹€æ…‹
  sales_volume INTEGER, -- éŠ·å”®é‡
  rating DECIMAL(3, 2), -- è©•åˆ†
  product_url TEXT,
  scraped_at TIMESTAMP DEFAULT NOW(),
  is_available BOOLEAN DEFAULT true
);

CREATE INDEX idx_price_product ON price_records(product_id);
CREATE INDEX idx_price_vendor ON price_records(vendor_id);
CREATE INDEX idx_price_date ON price_records(scraped_at);
```

### Vendors (å» å•†è¡¨)
```sql
CREATE TABLE vendors (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name VARCHAR(200) NOT NULL,
  platform VARCHAR(100), -- å¹³å°åç¨± (è¦çš®ã€éœ²å¤©ç­‰)
  contact_person VARCHAR(100),
  email VARCHAR(255),
  phone VARCHAR(50),
  address TEXT,
  website TEXT,
  rating DECIMAL(3, 2), -- å» å•†è©•åˆ†
  notes TEXT,
  tags TEXT[], -- æ¨™ç±¤
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  user_id UUID REFERENCES users(id)
);

CREATE INDEX idx_vendors_platform ON vendors(platform);
CREATE INDEX idx_vendors_user ON vendors(user_id);
```

### Orders (è¨‚å–®è¡¨)
```sql
CREATE TABLE orders (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  order_number VARCHAR(100) UNIQUE NOT NULL,
  vendor_id UUID REFERENCES vendors(id),
  status VARCHAR(50) DEFAULT 'pending', -- pending, confirmed, shipped, delivered, cancelled
  total_amount DECIMAL(10, 2) NOT NULL,
  shipping_fee DECIMAL(10, 2),
  notes TEXT,
  order_date TIMESTAMP DEFAULT NOW(),
  expected_delivery DATE,
  actual_delivery DATE,
  tracking_number VARCHAR(200),
  user_id UUID REFERENCES users(id)
);

CREATE INDEX idx_orders_status ON orders(status);
CREATE INDEX idx_orders_vendor ON orders(vendor_id);
CREATE INDEX idx_orders_user ON orders(user_id);
```

### Order_Items (è¨‚å–®æ˜ç´°è¡¨)
```sql
CREATE TABLE order_items (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  order_id UUID REFERENCES orders(id),
  product_id UUID REFERENCES products(id),
  quantity INTEGER NOT NULL,
  unit_price DECIMAL(10, 2) NOT NULL,
  subtotal DECIMAL(10, 2) NOT NULL,
  specs JSONB -- å•†å“è¦æ ¼ï¼ˆé¡è‰²ã€å°ºå¯¸ç­‰ï¼‰
);

CREATE INDEX idx_order_items_order ON order_items(order_id);
```

### Comparison_Tasks (æ¯”åƒ¹ä»»å‹™è¡¨)
```sql
CREATE TABLE comparison_tasks (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  task_name VARCHAR(200),
  search_type VARCHAR(50), -- url, image, keyword
  search_input TEXT,
  platforms TEXT[], -- ç›®æ¨™å¹³å°
  status VARCHAR(50) DEFAULT 'pending', -- pending, running, completed, failed
  total_products INTEGER,
  completed_products INTEGER,
  created_at TIMESTAMP DEFAULT NOW(),
  completed_at TIMESTAMP,
  user_id UUID REFERENCES users(id)
);

CREATE INDEX idx_tasks_status ON comparison_tasks(status);
CREATE INDEX idx_tasks_user ON comparison_tasks(user_id);
```

---

## ğŸ”§ æŠ€è¡“æ¶æ§‹

### å‰ç«¯æŠ€è¡“æ£§
- **æ¡†æ¶**: React 18 + TypeScript
- **ç‹€æ…‹ç®¡ç†**: Zustand / React Query
- **UIæ¡†æ¶**: Tailwind CSS + shadcn/ui
- **åœ–è¡¨**: Recharts (åƒ¹æ ¼èµ°å‹¢åœ–)
- **åœ–ç‰‡ä¸Šå‚³**: react-dropzone
- **è¡¨æ ¼**: TanStack Table (æ‰¹é‡å•†å“é¡¯ç¤º)

### å¾Œç«¯æŠ€è¡“æ£§
- **é‹è¡Œç’°å¢ƒ**: Node.js 18+
- **æ¡†æ¶**: Express.js / Fastify
- **æ•¸æ“šåº«**: PostgreSQL 15+ (Supabase)
- **å¿«å–**: Redis (åƒ¹æ ¼å¿«å–)
- **çˆ¬èŸ²å¼•æ“**:
  - Puppeteer (å‹•æ…‹ç¶²é )
  - Playwright (è¤‡é›œåçˆ¬ç¶²ç«™)
  - Cheerio (éœæ…‹ç¶²é )
- **åœ–ç‰‡è­˜åˆ¥**:
  - Google Vision API
  - OpenAI GPT-4 Vision
  - ç™¾åº¦åœ–ç‰‡è­˜åˆ¥API

### DevOps
- **éƒ¨ç½²**: Vercel (å‰ç«¯) + Railway/Render (å¾Œç«¯)
- **ä»»å‹™éšŠåˆ—**: Bull (çˆ¬èŸ²ä»»å‹™éšŠåˆ—)
- **ç›£æ§**: Sentry (éŒ¯èª¤è¿½è¹¤)
- **æ—¥èªŒ**: Winston

---

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½å¯¦ä½œ

### 1. æ™ºèƒ½æœå°‹æ¨¡çµ„

#### URLæœå°‹
```typescript
interface URLSearchInput {
  url: string;
  platforms?: string[]; // è¦æ¯”åƒ¹çš„å¹³å°
}

async function searchByURL(input: URLSearchInput) {
  // 1. è§£æURLï¼Œæå–å•†å“è³‡è¨Š
  const productInfo = await extractProductInfo(input.url);

  // 2. ä½¿ç”¨å•†å“åç¨±åœ¨å…¶ä»–å¹³å°æœå°‹
  const keywords = generateSearchKeywords(productInfo);

  // 3. æ‰¹é‡çˆ¬å–å„å¹³å°
  const results = await crawlMultiplePlatforms(keywords, input.platforms);

  // 4. æ¯”å°å•†å“ç›¸ä¼¼åº¦
  const matched = await matchProducts(productInfo, results);

  return matched;
}
```

#### åœ–ç‰‡æœå°‹
```typescript
interface ImageSearchInput {
  imageFile: File | string; // åœ–ç‰‡æª”æ¡ˆæˆ–URL
  platforms?: string[];
}

async function searchByImage(input: ImageSearchInput) {
  // 1. ä¸Šå‚³åœ–ç‰‡åˆ°å„²å­˜æœå‹™
  const imageUrl = await uploadImage(input.imageFile);

  // 2. ä½¿ç”¨AIè­˜åˆ¥å•†å“è³‡è¨Š
  const aiResult = await identifyProduct(imageUrl);
  // è¿”å›: { category, keywords, attributes }

  // 3. ä½¿ç”¨è­˜åˆ¥çµæœæœå°‹å„å¹³å°
  const searchResults = await crawlMultiplePlatforms(
    aiResult.keywords,
    input.platforms
  );

  // 4. ä½¿ç”¨åœ–ç‰‡ç›¸ä¼¼åº¦æ¯”å°
  const matched = await visualMatch(imageUrl, searchResults);

  return matched;
}
```

#### é—œéµå­—æœå°‹
```typescript
interface KeywordSearchInput {
  keyword: string;
  platforms: string[];
  filters?: {
    priceMin?: number;
    priceMax?: number;
    minSales?: number;
    minRating?: number;
  };
}

async function searchByKeyword(input: KeywordSearchInput) {
  // 1. é—œéµå­—å„ªåŒ–
  const optimizedKeywords = await optimizeKeywords(input.keyword);

  // 2. ä¸¦è¡Œçˆ¬å–æ‰€æœ‰å¹³å°
  const crawlers = input.platforms.map(platform =>
    crawlPlatform(platform, optimizedKeywords, input.filters)
  );

  const results = await Promise.allSettled(crawlers);

  // 3. åˆä½µèˆ‡å»é‡
  const merged = mergeAndDeduplicate(results);

  return merged;
}
```

### 2. çˆ¬èŸ²å¼•æ“æ¨¡çµ„

æ”¯æŒçš„é›»å•†å¹³å°ï¼š
- è¦çš®è³¼ç‰© (Shopee)
- éœ²å¤©æ‹è³£ (Ruten)
- PChome 24hè³¼ç‰©
- momoè³¼ç‰©ç¶²
- æ·˜å¯¶/1688 (éœ€ä»£ç†)
- Yahooå¥‡æ‘©è³¼ç‰©
- æ¨‚å¤©å¸‚å ´

```typescript
// çˆ¬èŸ²åŸºç¤é¡åˆ¥
abstract class PlatformCrawler {
  abstract platformName: string;

  async search(keyword: string, filters?: any): Promise<Product[]> {
    // 1. æ§‹å»ºæœå°‹URL
    const searchUrl = this.buildSearchUrl(keyword, filters);

    // 2. ç™¼é€è«‹æ±‚
    const page = await this.browser.newPage();
    await page.goto(searchUrl);

    // 3. ç­‰å¾…å•†å“åŠ è¼‰
    await this.waitForProducts(page);

    // 4. æå–å•†å“è³‡è¨Š
    const products = await this.extractProducts(page);

    // 5. æ¸…ç†
    await page.close();

    return products;
  }

  abstract buildSearchUrl(keyword: string, filters?: any): string;
  abstract waitForProducts(page: Page): Promise<void>;
  abstract extractProducts(page: Page): Promise<Product[]>;
}

// è¦çš®çˆ¬èŸ²å¯¦ä½œ
class ShopeeCrawler extends PlatformCrawler {
  platformName = 'Shopee';

  buildSearchUrl(keyword: string, filters?: any): string {
    const params = new URLSearchParams({
      keyword: keyword,
      sortBy: filters?.sortBy || 'relevancy',
      // ... å…¶ä»–åƒæ•¸
    });
    return `https://shopee.tw/search?${params}`;
  }

  async extractProducts(page: Page): Promise<Product[]> {
    return await page.$$eval('.shopee-search-item-result__item', items => {
      return items.map(item => ({
        name: item.querySelector('.shopee-item-card__text-name')?.textContent,
        price: parsePrice(item.querySelector('.shopee-price')?.textContent),
        sales: parseSales(item.querySelector('.shopee-sales')?.textContent),
        // ... å…¶ä»–æ¬„ä½
      }));
    });
  }
}
```

### 3. æ‰¹é‡æ¯”åƒ¹æ¨¡çµ„

```typescript
interface BatchComparisonInput {
  products: Array<{
    identifier: string; // URLã€åœ–ç‰‡URLæˆ–é—œéµå­—
    type: 'url' | 'image' | 'keyword';
  }>;
  platforms: string[];
  sortBy: 'price' | 'sales' | 'rating';
}

async function batchComparison(input: BatchComparisonInput) {
  // 1. å‰µå»ºæ¯”åƒ¹ä»»å‹™
  const task = await createComparisonTask({
    total_products: input.products.length,
    platforms: input.platforms,
  });

  // 2. ä½¿ç”¨ä»»å‹™éšŠåˆ—è™•ç†ï¼ˆé¿å…é˜»å¡ï¼‰
  const queue = new Bull('comparison-queue');

  for (const product of input.products) {
    await queue.add('compare-product', {
      taskId: task.id,
      product,
      platforms: input.platforms,
    });
  }

  // 3. è¿”å›ä»»å‹™IDï¼Œå‰ç«¯å¯è¼ªè©¢é€²åº¦
  return { taskId: task.id };
}

// Workerè™•ç†
queue.process('compare-product', async (job) => {
  const { taskId, product, platforms } = job.data;

  let results;
  switch (product.type) {
    case 'url':
      results = await searchByURL({ url: product.identifier, platforms });
      break;
    case 'image':
      results = await searchByImage({ imageFile: product.identifier, platforms });
      break;
    case 'keyword':
      results = await searchByKeyword({ keyword: product.identifier, platforms });
      break;
  }

  // å„²å­˜çµæœ
  await savePriceRecords(results);

  // æ›´æ–°ä»»å‹™é€²åº¦
  await updateTaskProgress(taskId);

  return results;
});
```

### 4. å» å•†ç®¡ç†æ¨¡çµ„

```typescript
// å¾æ¯”åƒ¹çµæœæ·»åŠ å» å•†
async function addVendorFromComparison(priceRecordId: string) {
  const priceRecord = await getPriceRecord(priceRecordId);

  // æª¢æŸ¥å» å•†æ˜¯å¦å·²å­˜åœ¨
  let vendor = await findVendorByUrl(priceRecord.product_url);

  if (!vendor) {
    // è‡ªå‹•æå–å» å•†è³‡è¨Š
    const vendorInfo = await extractVendorInfo(priceRecord.product_url);

    vendor = await createVendor({
      name: vendorInfo.name,
      platform: vendorInfo.platform,
      website: vendorInfo.url,
      rating: priceRecord.rating,
    });
  }

  return vendor;
}

// å» å•†è©•åˆ†ç³»çµ±
async function rateVendor(vendorId: string, rating: number, note?: string) {
  await updateVendor(vendorId, {
    rating: rating,
    notes: note,
  });

  // è¨˜éŒ„è©•åˆ†æ­·å²
  await createVendorRating({
    vendor_id: vendorId,
    rating,
    note,
  });
}
```

### 5. è¨‚è³¼è¿½è¹¤æ¨¡çµ„

```typescript
// å¾å» å•†å‰µå»ºè¨‚å–®
async function createOrderFromVendor(input: {
  vendorId: string;
  items: Array<{
    productId: string;
    quantity: number;
    unitPrice: number;
    specs?: any;
  }>;
  shippingFee?: number;
  notes?: string;
}) {
  // è¨ˆç®—ç¸½é‡‘é¡
  const totalAmount = input.items.reduce(
    (sum, item) => sum + item.quantity * item.unitPrice,
    0
  ) + (input.shippingFee || 0);

  // ç”Ÿæˆè¨‚å–®ç·¨è™Ÿ
  const orderNumber = generateOrderNumber();

  // å‰µå»ºè¨‚å–®
  const order = await createOrder({
    order_number: orderNumber,
    vendor_id: input.vendorId,
    total_amount: totalAmount,
    shipping_fee: input.shippingFee,
    notes: input.notes,
    status: 'pending',
  });

  // å‰µå»ºè¨‚å–®æ˜ç´°
  for (const item of input.items) {
    await createOrderItem({
      order_id: order.id,
      product_id: item.productId,
      quantity: item.quantity,
      unit_price: item.unitPrice,
      subtotal: item.quantity * item.unitPrice,
      specs: item.specs,
    });
  }

  return order;
}

// æ›´æ–°è¨‚å–®ç‹€æ…‹
async function updateOrderStatus(
  orderId: string,
  status: OrderStatus,
  trackingNumber?: string
) {
  await updateOrder(orderId, {
    status,
    tracking_number: trackingNumber,
    ...(status === 'delivered' && { actual_delivery: new Date() }),
  });

  // ç™¼é€é€šçŸ¥
  await sendOrderNotification(orderId, status);
}
```

---

## ğŸ¨ å‰ç«¯åŠŸèƒ½é é¢

### 1. æœå°‹é é¢
```typescript
// components/SearchInterface.tsx
function SearchInterface() {
  const [searchType, setSearchType] = useState<'url' | 'image' | 'keyword'>('keyword');
  const [selectedPlatforms, setSelectedPlatforms] = useState<string[]>([]);

  return (
    <div className="search-container">
      {/* æœå°‹æ–¹å¼é¸æ“‡ */}
      <Tabs value={searchType} onValueChange={setSearchType}>
        <TabsList>
          <TabsTrigger value="keyword">é—œéµå­—</TabsTrigger>
          <TabsTrigger value="url">ç¶²å€</TabsTrigger>
          <TabsTrigger value="image">åœ–ç‰‡</TabsTrigger>
        </TabsList>

        <TabsContent value="keyword">
          <KeywordSearch platforms={selectedPlatforms} />
        </TabsContent>

        <TabsContent value="url">
          <URLSearch platforms={selectedPlatforms} />
        </TabsContent>

        <TabsContent value="image">
          <ImageSearch platforms={selectedPlatforms} />
        </TabsContent>
      </Tabs>

      {/* å¹³å°é¸æ“‡ */}
      <PlatformSelector
        selected={selectedPlatforms}
        onChange={setSelectedPlatforms}
      />
    </div>
  );
}
```

### 2. æ¯”åƒ¹çµæœé é¢
```typescript
// components/ComparisonResults.tsx
function ComparisonResults({ taskId }: { taskId: string }) {
  const { data, isLoading } = useComparisonTask(taskId);
  const [sortBy, setSortBy] = useState<'price' | 'sales'>('price');

  return (
    <div className="results-container">
      {/* é€²åº¦æ¢ */}
      <Progress
        value={(data.completed_products / data.total_products) * 100}
      />

      {/* æ’åºé¸é … */}
      <Select value={sortBy} onValueChange={setSortBy}>
        <SelectItem value="price">åƒ¹æ ¼æ’åº</SelectItem>
        <SelectItem value="sales">éŠ·é‡æ’åº</SelectItem>
        <SelectItem value="rating">è©•åˆ†æ’åº</SelectItem>
      </Select>

      {/* çµæœè¡¨æ ¼ */}
      <DataTable
        columns={comparisonColumns}
        data={sortResults(data.results, sortBy)}
        onAddVendor={handleAddVendor}
        onCreateOrder={handleCreateOrder}
      />

      {/* åƒ¹æ ¼èµ°å‹¢åœ– */}
      <PriceChart data={data.priceHistory} />
    </div>
  );
}
```

### 3. å» å•†ç®¡ç†é é¢
```typescript
// components/VendorManagement.tsx
function VendorManagement() {
  const { vendors } = useVendors();

  return (
    <div className="vendor-container">
      {/* å» å•†åˆ—è¡¨ */}
      <VendorList
        vendors={vendors}
        onEdit={handleEdit}
        onRate={handleRate}
      />

      {/* å» å•†è©³æƒ… */}
      <VendorDetail
        vendor={selectedVendor}
        orders={vendorOrders}
        priceHistory={vendorPriceHistory}
      />
    </div>
  );
}
```

### 4. è¨‚å–®è¿½è¹¤é é¢
```typescript
// components/OrderTracking.tsx
function OrderTracking() {
  const { orders } = useOrders();

  return (
    <div className="order-container">
      {/* è¨‚å–®ç‹€æ…‹çµ±è¨ˆ */}
      <OrderStats orders={orders} />

      {/* è¨‚å–®åˆ—è¡¨ */}
      <OrderList
        orders={orders}
        onUpdateStatus={handleUpdateStatus}
        onViewDetails={handleViewDetails}
      />

      {/* ç‰©æµè¿½è¹¤ */}
      <ShippingTracker
        trackingNumber={selectedOrder?.tracking_number}
      />
    </div>
  );
}
```

---

## ğŸ” å®‰å…¨æ€§è€ƒæ…®

### 1. çˆ¬èŸ²é˜²è­·
- ä½¿ç”¨ä»£ç†IPæ± ï¼Œé¿å…IPè¢«å°é–
- æ·»åŠ éš¨æ©Ÿå»¶é²ï¼Œæ¨¡æ“¬çœŸå¯¦ç”¨æˆ¶è¡Œç‚º
- ä½¿ç”¨User-Agentè¼ªæ›
- æ”¯æŒé©—è­‰ç¢¼è­˜åˆ¥ï¼ˆ2Captcha/Anti-Captchaï¼‰

### 2. æ•¸æ“šå®‰å…¨
- å» å•†è¯çµ¡è³‡è¨ŠåŠ å¯†å­˜å„²
- APIä½¿ç”¨JWTèªè­‰
- Rate limitingé˜²æ­¢æ¿«ç”¨
- æ•¸æ“šå®šæœŸå‚™ä»½

### 3. éš±ç§ä¿è­·
- ç”¨æˆ¶æ•¸æ“šéš”é›¢
- GDPRåˆè¦
- æœå°‹æ­·å²è‡ªå‹•æ¸…ç†é¸é …

---

## ğŸ“Š é€²éšåŠŸèƒ½

### 1. åƒ¹æ ¼ç›£æ§èˆ‡é€šçŸ¥
```typescript
// è¨­å®šåƒ¹æ ¼æé†’
async function setPriceAlert(productId: string, targetPrice: number) {
  await createPriceAlert({
    product_id: productId,
    target_price: targetPrice,
    notification_methods: ['email', 'push'],
  });

  // Cron jobæ¯å°æ™‚æª¢æŸ¥
  cron.schedule('0 * * * *', async () => {
    const alerts = await getActivePriceAlerts();
    for (const alert of alerts) {
      const currentPrice = await getCurrentPrice(alert.product_id);
      if (currentPrice <= alert.target_price) {
        await sendPriceAlert(alert);
      }
    }
  });
}
```

### 2. æ­·å²åƒ¹æ ¼åˆ†æ
- åƒ¹æ ¼èµ°å‹¢åœ–è¡¨
- æœ€ä½åƒ¹æ ¼æç¤º
- åƒ¹æ ¼æ³¢å‹•åˆ†æ
- æœ€ä½³è³¼è²·æ™‚æ©Ÿé æ¸¬

### 3. æ‰¹é‡åŒ¯å…¥/åŒ¯å‡º
- CSVåŒ¯å…¥å•†å“åˆ—è¡¨
- ExcelåŒ¯å‡ºæ¯”åƒ¹çµæœ
- è¨‚å–®æ•¸æ“šåŒ¯å‡º

### 4. APIå°æ¥
```typescript
// æä¾›RESTful API
app.post('/api/v1/compare', async (req, res) => {
  const { products, platforms, sortBy } = req.body;
  const task = await batchComparison({ products, platforms, sortBy });
  res.json({ taskId: task.taskId });
});

app.get('/api/v1/compare/:taskId', async (req, res) => {
  const task = await getComparisonTask(req.params.taskId);
  res.json(task);
});
```

---

## ğŸš€ å¯¦æ–½éšæ®µ

### Phase 1: MVP (4-6é€±)
- [ ] åŸºç¤æœå°‹åŠŸèƒ½ï¼ˆé—œéµå­—ï¼‰
- [ ] 2-3å€‹ä¸»è¦å¹³å°çˆ¬èŸ²
- [ ] ç°¡å–®æ¯”åƒ¹çµæœé¡¯ç¤º
- [ ] åŸºç¤å» å•†è¨˜éŒ„

### Phase 2: æ ¸å¿ƒåŠŸèƒ½ (6-8é€±)
- [ ] URLèˆ‡åœ–ç‰‡æœå°‹
- [ ] 5+å¹³å°æ”¯æŒ
- [ ] æ‰¹é‡æ¯”åƒ¹åŠŸèƒ½
- [ ] å®Œæ•´å» å•†ç®¡ç†ç³»çµ±
- [ ] è¨‚å–®è¿½è¹¤

### Phase 3: é€²éšåŠŸèƒ½ (4-6é€±)
- [ ] åƒ¹æ ¼ç›£æ§èˆ‡æé†’
- [ ] æ­·å²åƒ¹æ ¼åˆ†æ
- [ ] æ•¸æ“šåŒ¯å…¥/åŒ¯å‡º
- [ ] APIé–‹æ”¾

### Phase 4: å„ªåŒ– (æŒçºŒ)
- [ ] æ€§èƒ½å„ªåŒ–
- [ ] æ›´å¤šå¹³å°æ”¯æŒ
- [ ] AIæ™ºèƒ½æ¨è–¦
- [ ] ç§»å‹•ç«¯App

---

## ğŸ’° æˆæœ¬ä¼°ç®—

### æœå‹™å™¨æˆæœ¬
- **å‰ç«¯è¨—ç®¡**: Vercel Pro ($20/æœˆ)
- **å¾Œç«¯æœå‹™**: Railway ($20-50/æœˆ)
- **æ•¸æ“šåº«**: Supabase Pro ($25/æœˆ)
- **Rediså¿«å–**: Upstash ($10/æœˆ)

### ç¬¬ä¸‰æ–¹æœå‹™
- **åœ–ç‰‡è­˜åˆ¥**: Google Vision API (~$15/1000æ¬¡)
- **ä»£ç†IP**: Bright Data (~$50/æœˆ)
- **é©—è­‰ç¢¼è­˜åˆ¥**: 2Captcha (~$3/1000æ¬¡)

### ç¸½è¨ˆ
ç´„ **$150-200/æœˆ** (ä¸­ç­‰æµé‡)

---

## ğŸ“ æ³¨æ„äº‹é …

1. **æ³•å¾‹åˆè¦**: ç¢ºä¿çˆ¬èŸ²éµå®ˆå„å¹³å°çš„robots.txtå’Œæœå‹™æ¢æ¬¾
2. **åçˆ¬ç­–ç•¥**: æŒçºŒæ›´æ–°çˆ¬èŸ²é‚è¼¯ä»¥æ‡‰å°å¹³å°åçˆ¬æ©Ÿåˆ¶
3. **æ•¸æ“šæº–ç¢ºæ€§**: å®šæœŸé©—è­‰çˆ¬å–æ•¸æ“šçš„æº–ç¢ºæ€§
4. **æ“´å±•æ€§**: ä½¿ç”¨å¾®æœå‹™æ¶æ§‹ä¾¿æ–¼å¾ŒçºŒæ“´å±•
5. **ç›£æ§**: è¨­ç½®å®Œå–„çš„éŒ¯èª¤ç›£æ§å’Œæ—¥èªŒç³»çµ±

---

## ğŸ¯ æˆåŠŸæŒ‡æ¨™

- æ”¯æŒå¹³å°æ•¸é‡: ç›®æ¨™10+
- æœå°‹æº–ç¢ºç‡: >90%
- åƒ¹æ ¼æ›´æ–°é »ç‡: æ¯4-6å°æ™‚
- æ‰¹é‡æ¯”åƒ¹é€Ÿåº¦: 100å€‹å•†å“<5åˆ†é˜
- ç³»çµ±å¯ç”¨æ€§: >99.5%

---

## ğŸ“š ç›¸é—œæ–‡æª”

- [APIæ–‡æª”](./API_DOCUMENTATION.md)
- [çˆ¬èŸ²é–‹ç™¼æŒ‡å—](./CRAWLER_GUIDE.md)
- [éƒ¨ç½²æŒ‡å—](./DEPLOYMENT_GUIDE.md)
- [ç¶­è­·æ‰‹å†Š](./MAINTENANCE_GUIDE.md)

---

**æ›´æ–°æ—¥æœŸ**: 2025-11-20
**ç‰ˆæœ¬**: 1.0.0
